# Description
This directory includes all files needed to run an optimization case where the NPV calculations
are conducted externally. As an example case, we consider a CO2 injection with water production.
The base model is jointly optimized with well placement and well control. The optimization has 
been tested to run successfully in an Ubuntu 22.04 environment.

# Tables of content
- [Introduction](#Introduction)
- [Features](#Features)
- [Installation](#Installation)
- [Usage](#Usage)
- [Contact](#Contact)

# Introduction
This case is based on the simulation of CO2 flow behavior. It demonstrates how
FieldOpt supports optimization where the NPV calculations are conducted externally. The example employs
the "ExternalResult" objective type — a new method that enables the objective function value calculation
outside the FieldOpt framework. In this example case, the external calculations are conducted using a 
Python code. The initial configuration of the JSON driver file could be adjusted to improve the post-run
optimal result.

# Features

The model:
- **The tilt cubic model** : the model is a 10×10×15 grid. The grid is tilted, representing a geological structure with a dip.
- **The random field generation** : the permeability and porosity values are
  generated by an isotropic Gaussian covariance model.

The Python file directory :
- **The Objective function class** : \
  This Python class uses `resdata` package to post-process the simulation
  results, the child class - NPV calculation - is coded for a standard net present value calculation.
- **The Objective function case** :
    1) This Python case file contains a tuple data structure - a variable to
       store the NPV component argument, such as well name, data type, fluid price, etc.
    2) The case NPV is calculated by the objective function class.
    3) The Python file takes the optimized case UNSMARY file path and external objective
       result file path as arguments and store the values into an ASCII (*.txt) file.
- **Path handler** : \
  The objective function result file path is the key argument for the example.
    1) The path handler Python script takes two arguments as input:
        1) The JSON driver file path
        2) The (optimization) output directory path
    2) The path handler mainly works to:
        1) Create the objective function result file in the output directory.
        2) Assign the external objective function result file path argument into the JSON drive file.

# Installation
The Python package `resdata` (<https://github.com/equinor/resdata>) needs to be installed before
running the example. By default, a running version of FieldOpt 
and `python3` is expected. If 'resdata' is not installed in 'python3', then try the following:
``` bash
# Install the resdata package with pip
pip install resdata
```

# Usage
The `run_example_Python` script runs this example case. The file 
`base_bash` has a new line added to execute the objection function calculation by the 'python3'
interpreter. Before running the example, a compiled version of FieldOpt should exist in the "\bin" folder. 
If not, please update the path to your FieldOpt executable.

```bash
# running the example with GA algorithm 
bash run_example_Python.sh GA PythonFile/
```
```bash
# running the example with PSO algorithm 
bash run_example_Python.sh PSO PythonFile/
```

# Contact
This example is part of the master's project by Wang Hou (wang.hou@ntnu.no). All the data is open-source
and free to be used and modified. An alternative contact is Carl Fredrik Berg (carl.f.berg@ntnu.no)

